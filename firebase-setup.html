<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UTM Manager - Firebase 雲端儲存設定</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="shared/styles.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
  <!-- 導航列 -->
  <nav class="bg-white shadow-sm border-b border-gray-100 px-6 py-4">
    <div class="max-w-7xl mx-auto flex justify-between items-center">
      <div class="flex items-center gap-3">
        <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg flex items-center justify-center">
          <i class="fas fa-link text-white text-sm"></i>
        </div>
        <h1 class="text-xl font-semibold text-gray-900">UTM Manager</h1>
      </div>
      <div class="flex gap-2">
        <a href="index.html" class="nav-tab-modern">
          <i class="fas fa-magic"></i>
          <span>產生器</span>
        </a>
        <a href="history.html" class="nav-tab-modern">
          <i class="fas fa-history"></i>
          <span>我的連結</span>
        </a>
        <a href="templates.html" class="nav-tab-modern">
          <i class="fas fa-bookmark"></i>
          <span>常用範本</span>
        </a>
      </div>
    </div>
  </nav>

  <!-- 主要內容 -->
  <div class="min-h-screen bg-gray-50">
    <div class="max-w-4xl mx-auto px-6 py-8">
      <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-8">
        <div class="text-center mb-8">
          <div class="w-16 h-16 bg-gradient-to-r from-orange-500 to-red-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-cloud text-white text-2xl"></i>
          </div>
          <h1 class="text-3xl font-bold text-gray-900 mb-2">Firebase 雲端儲存設定</h1>
          <p class="text-gray-600">設定 Firebase 實現跨裝置資料同步</p>
        </div>

        <!-- 設定步驟 -->
        <div class="space-y-8">
          <!-- 步驟1 -->
          <div class="border border-gray-200 rounded-2xl p-6">
            <div class="flex items-center gap-3 mb-4">
              <div class="w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center font-bold">1</div>
              <h2 class="text-xl font-semibold">建立 Firebase 專案</h2>
            </div>
            <div class="ml-11 space-y-3 text-gray-600">
              <p>• 前往 <a href="https://console.firebase.google.com" target="_blank" class="text-blue-600 hover:underline">Firebase Console</a></p>
              <p>• 點擊「建立專案」</p>
              <p>• 輸入專案名稱（例如：utm-manager）</p>
              <p>• 啟用 Google Analytics（可選）</p>
            </div>
          </div>

          <!-- 步驟2 -->
          <div class="border border-gray-200 rounded-2xl p-6">
            <div class="flex items-center gap-3 mb-4">
              <div class="w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center font-bold">2</div>
              <h2 class="text-xl font-semibold">設定 Firestore 資料庫</h2>
            </div>
            <div class="ml-11 space-y-3 text-gray-600">
              <p>• 在左側選單點擊「Firestore Database」</p>
              <p>• 點擊「建立資料庫」</p>
              <p>• 選擇「以測試模式啟動」（30天免費）</p>
              <p>• 選擇資料庫位置（建議：asia-east1）</p>
            </div>
          </div>

          <!-- 步驟3 -->
          <div class="border border-gray-200 rounded-2xl p-6">
            <div class="flex items-center gap-3 mb-4">
              <div class="w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center font-bold">3</div>
              <h2 class="text-xl font-semibold">建立 Web 應用程式</h2>
            </div>
            <div class="ml-11 space-y-3 text-gray-600">
              <p>• 在專案總覽點擊「Web」圖標（&lt;/&gt;）</p>
              <p>• 輸入應用程式名稱：UTM Manager</p>
              <p>• 勾選「設定 Firebase Hosting」（可選）</p>
              <p>• 點擊「註冊應用程式」</p>
            </div>
          </div>

          <!-- 步驟4 -->
          <div class="border border-gray-200 rounded-2xl p-6">
            <div class="flex items-center gap-3 mb-4">
              <div class="w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center font-bold">4</div>
              <h2 class="text-xl font-semibold">複製設定資訊</h2>
            </div>
            <div class="ml-11 space-y-3 text-gray-600">
              <p>• 複製 Firebase 設定物件（firebaseConfig）</p>
              <p>• 格式類似：</p>
              <pre class="bg-gray-100 p-3 rounded text-xs overflow-x-auto"><code>{
  apiKey: "AIza...",
  authDomain: "your-project.firebaseapp.com",
  projectId: "your-project",
  storageBucket: "your-project.appspot.com",
  messagingSenderId: "123456789",
  appId: "1:123456789:web:abcdef"
}</code></pre>
            </div>
          </div>

          <!-- 設定表單 -->
          <div class="border border-green-200 rounded-2xl p-6 bg-green-50">
            <div class="flex items-center gap-3 mb-4">
              <div class="w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center font-bold">5</div>
              <h2 class="text-xl font-semibold">輸入 Firebase 設定</h2>
            </div>
            <div class="ml-11 space-y-4">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium mb-1">API Key</label>
                  <input type="text" id="apiKey" placeholder="AIza..." class="form-input">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">Auth Domain</label>
                  <input type="text" id="authDomain" placeholder="your-project.firebaseapp.com" class="form-input">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">Project ID</label>
                  <input type="text" id="projectId" placeholder="your-project" class="form-input">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">Storage Bucket</label>
                  <input type="text" id="storageBucket" placeholder="your-project.appspot.com" class="form-input">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">Messaging Sender ID</label>
                  <input type="text" id="messagingSenderId" placeholder="123456789" class="form-input">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">App ID</label>
                  <input type="text" id="appId" placeholder="1:123456789:web:abcdef" class="form-input">
                </div>
              </div>
              <div class="flex gap-3 mt-6">
                <button id="saveConfig" class="bg-gradient-to-r from-green-500 to-green-600 text-white px-6 py-3 rounded-xl font-medium hover:from-green-600 hover:to-green-700 transition-all flex items-center gap-2">
                  <i class="fas fa-save"></i>
                  儲存設定
                </button>
                <button id="testConnection" class="bg-white border border-green-200 text-green-700 px-6 py-3 rounded-xl font-medium hover:bg-green-50 transition-all flex items-center gap-2">
                  <i class="fas fa-plug"></i>
                  測試連線
                </button>
              </div>
            </div>
          </div>

          <!-- 狀態顯示 -->
          <div id="statusDisplay" class="hidden p-4 rounded-xl">
            <div id="statusMessage"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>

  <script src="shared/utils.js"></script>
  <script src="shared/firebase-storage.js"></script>
  <script>
    // 載入現有設定
    function loadExistingConfig() {
      const config = firebaseStorage.getFirebaseConfig();
      if (config) {
        document.getElementById('apiKey').value = config.apiKey || '';
        document.getElementById('authDomain').value = config.authDomain || '';
        document.getElementById('projectId').value = config.projectId || '';
        document.getElementById('storageBucket').value = config.storageBucket || '';
        document.getElementById('messagingSenderId').value = config.messagingSenderId || '';
        document.getElementById('appId').value = config.appId || '';
      }
    }

    // 儲存設定
    document.getElementById('saveConfig').addEventListener('click', () => {
      const config = {
        apiKey: document.getElementById('apiKey').value.trim(),
        authDomain: document.getElementById('authDomain').value.trim(),
        projectId: document.getElementById('projectId').value.trim(),
        storageBucket: document.getElementById('storageBucket').value.trim(),
        messagingSenderId: document.getElementById('messagingSenderId').value.trim(),
        appId: document.getElementById('appId').value.trim()
      };

      // 驗證必填欄位
      if (!config.apiKey || !config.authDomain || !config.projectId || !config.appId) {
        showStatus('請填寫所有必填欄位', 'error');
        return;
      }

      firebaseStorage.setFirebaseConfig(config);
      showStatus('✅ Firebase 設定已儲存！', 'success');
    });

    // 測試連線
    document.getElementById('testConnection').addEventListener('click', async () => {
      try {
        showStatus('正在測試 Firebase 連線...', 'info');
        
        const success = await firebaseStorage.initialize();
        if (success) {
          // 嘗試匿名登入
          const loginSuccess = await firebaseStorage.signInAnonymously();
          if (loginSuccess) {
            showStatus('✅ Firebase 連線成功！可以開始使用雲端同步功能', 'success');
          } else {
            showStatus('⚠️ Firebase 連線成功，但登入失敗', 'warning');
          }
        } else {
          showStatus('❌ Firebase 連線失敗，請檢查設定', 'error');
        }
      } catch (error) {
        showStatus(`❌ 連線測試失敗: ${error.message}`, 'error');
      }
    });

    // 顯示狀態
    function showStatus(message, type) {
      const statusDisplay = document.getElementById('statusDisplay');
      const statusMessage = document.getElementById('statusMessage');
      
      statusDisplay.className = `p-4 rounded-xl ${
        type === 'success' ? 'bg-green-50 border border-green-200' :
        type === 'error' ? 'bg-red-50 border border-red-200' :
        type === 'warning' ? 'bg-yellow-50 border border-yellow-200' :
        'bg-blue-50 border border-blue-200'
      }`;
      
      statusMessage.className = `${
        type === 'success' ? 'text-green-800' :
        type === 'error' ? 'text-red-800' :
        type === 'warning' ? 'text-yellow-800' :
        'text-blue-800'
      }`;
      
      statusMessage.textContent = message;
      statusDisplay.classList.remove('hidden');
    }

    // 頁面載入時載入現有設定
    document.addEventListener('DOMContentLoaded', loadExistingConfig);
  </script>

  <style>
    .nav-tab-modern {
      @apply flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-medium transition-all no-underline;
      @apply text-gray-600 hover:text-gray-900 hover:bg-gray-100;
    }
    
    .form-input {
      @apply w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all;
    }
  </style>
</body>
</html>